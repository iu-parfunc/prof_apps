
# These are written from the perspective of one of the per-variant
# subdirs of this directory.

include ../../Makefile_globals

.PHONY: default clean run

default:
	echo "THIS NEVER HAPPENS!!!" 

gen-data: 
	echo "Generating data here!"
	cd ../Data;\
             make
	cd ../Data;\
	     ./uniform -s -d 2 10000000 data.out



DATADIR=/u/crest-team/ubiprof_data

#Build with ubiprof finstrument baeckend
build-ubiprof: 
	cd ../quickHull; make clean;\
	make CFLAGS='$(OPTLEVEL) -finstrument-functions -fno-optimize-sibling-calls' LDFLAGS='-L../../../build -lubiprof -lrt' 

build-noprof: 
	cd ../quickHull; make clean;\
	make CFLAGS='$(OPTLEVEL) -finstrument-functions -fno-optimize-sibling-calls' LDFLAGS='-L../../../build/noprof -lubiprof -lrt' 



# Build with icc and profiling:
build-prof:
	echo -e "Building hull with gprof enabled..."
	$(MAKE) CFLAGS='$(OPTLEVEL) -pg' build-shared

build-plain:
	$(MAKE) CFLAGS='$(OPTLEVEL)' build-shared

build-shared:
	cd ../quickhull; make clean;\
		time make CFLAGS="$(CFLAGS)"

run-common: 
	(cd ../quickHull; if [ -d prof.out ]; then rm prof.out; fi )
	(cd ../quickHull; LD_LIBRARY_PATH=../../../build/:$(LD_LIBRARY_PATH) $(TIME) ./hull $(DATADIR)/hull_data.input) 2>&1 
	(cd ../quickHull; $(HSB_OUT))

run-noprof: 
	(cd ../quickHull; LD_LIBRARY_PATH=../../../build/noprof:$(LD_LIBRARY_PATH) $(TIME) ./hull $(DATADIR)/hull_data.input) 2>&1 
	(cd ../quickHull; $(HSB_OUT))


# run-common: 
# 	(cd ../quickHull; if [ -d prof.out ]; then rm prof.out; fi )
# 	(cd ../quickHull; LD_LIBRARY_PATH=../../../build/:$(LD_LIBRARY_PATH) /usr/bin/time -f "SELFTIMED %e\nuser %U\nsys %S\n" ./hull $(DATADIR)/hull_data.input) 2>&1 

# run-noprof: 
# 	(cd ../quickHull; LD_LIBRARY_PATH=../../../build/noprof:$(LD_LIBRARY_PATH) /usr/bin/time -f "SELFTIMED %e\nuser %U\nsys %S\n" ./hull $(DATADIR)/hull_data.input) 2>&1 


# We don't really need to clean, because we do a fresh "configure" on each build.
clean:
