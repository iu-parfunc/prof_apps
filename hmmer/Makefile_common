
# These are written from the perspective of one of the per-variant
# subdirs of this directory.

include ../../Makefile_globals

.PHONY: default clean run

default: 
	echo "Doing nothing during 'compile' phase... procrastinating until run."

#Build with ubiprof finstrument bacekend
build-ubiprof:
	cd ..;./setup.sh 
	cd ../instrumented; make clean;\
	make CFLAGS='$(OPTLEVEL) -finstrument-functions -fno-optimize-sibling-calls' LDFLAGS='-L../../../build -lrt -lubiprof -lm' 

build-noprof:
	cd ..;./setup.sh 
	cd ../instrumented; make clean;\
	make CFLAGS='$(OPTLEVEL) -finstrument-functions -fno-optimize-sibling-calls' LDFLAGS='-L../../../build/noprof -lrt -lubiprof -lm' 

# Build with icc and profiling:
build-prof:
	echo -e "Building hmmer with gprof enabled..."
	$(MAKE) CFLAGS='$(OPTLEVEL) -pg' build-shared

build-plain:
	$(MAKE) CFLAGS='$(OPTLEVEL)' build-shared

build-shared:
	cd ..; ./setup.sh
	cd ../instrumented;\
		time make CFLAGS="$(CFLAGS)"

run-common: 
	(cd ../instrumented; LD_LIBRARY_PATH=../../../build/:$(LD_LIBRARY_PATH) $(TIME) ./hmmer --fixed 0 --mean 500 --num 500000 --sd 350 --seed 0 ref/input/retro.hmm) 2>&1
	(cd ../instrumented; $(HSB_OUT))

run-noprof: 
	(cd ../instrumented; LD_LIBRARY_PATH=../../../build/noprof/:$(LD_LIBRARY_PATH) $(TIME) ./hmmer --fixed 0 --mean 500 --num 500000 --sd 350 --seed 0 ref/input/retro.hmm) 2>&1
	(cd ../instrumented; $(HSB_OUT))

# run-common: 
# 	(cd ../instrumented; LD_LIBRARY_PATH=../../../build/:$(LD_LIBRARY_PATH) /usr/bin/time -f "SELFTIMED %e\nuser %U\nsys %S\n" ./hmmer --fixed 0 --mean 500 --num 500000 --sd 350 --seed 0 ref/input/retro.hmm) 2>&1

# run-noprof: 
# 	(cd ../instrumented; LD_LIBRARY_PATH=../../../build/noprof/:$(LD_LIBRARY_PATH) /usr/bin/time -f "SELFTIMED %e\nuser %U\nsys %S\n" ./hmmer --fixed 0 --mean 500 --num 500000 --sd 350 --seed 0 ref/input/retro.hmm) 2>&1


# We don't really need to clean, because we do a fresh "configure" on each build.
clean:
